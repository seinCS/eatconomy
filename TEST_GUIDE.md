# 전체 시스템 테스트 가이드

## 테스트 환경 준비

### 1. 백엔드 서버 실행

```bash
cd backend
npm run start:dev
```

**확인사항**:
- 서버가 `http://localhost:3001/api`에서 실행되는지 확인
- 콘솔에 "🚀 Backend server is running on: http://localhost:3001/api" 메시지 확인

### 2. 프론트엔드 서버 실행

새 터미널에서:

```bash
npm run dev
```

**확인사항**:
- 서버가 `http://localhost:3000`에서 실행되는지 확인
- 브라우저에서 접속 가능한지 확인

### 3. 데이터베이스 확인

```bash
cd backend
npm run prisma:studio
```

**확인사항**:
- Prisma Studio가 `http://localhost:5555`에서 실행되는지 확인
- 데이터베이스 연결이 정상인지 확인

---

## 테스트 시나리오

### 테스트 1: 인증 및 사용자 생성

**목적**: 카카오 로그인으로 사용자 생성 및 JWT 토큰 발급 확인

**절차**:
1. 브라우저에서 `http://localhost:3000` 접속
2. "카카오로 3초 만에 시작하기" 버튼 클릭
3. 카카오 로그인 진행
4. 자동으로 홈 페이지로 리다이렉트되는지 확인

**예상 결과**:
- ✅ 카카오 로그인 페이지로 리다이렉트
- ✅ 로그인 후 홈 페이지로 이동
- ✅ 사용자 정보가 표시됨
- ✅ Prisma Studio에서 `users` 테이블에 새 사용자 생성 확인

**검증**:
```bash
# Prisma Studio에서 확인
# users 테이블에 새 레코드가 생성되었는지 확인
```

---

### 테스트 2: 사용자 프로필 및 선호도

**목적**: 사용자 정보 조회 및 선호도 업데이트 확인

**절차**:
1. 홈 페이지에서 프로필 아이콘 클릭 (또는 `/profile` 접속)
2. 선호도 설정:
   - 알러지: "계란", "우유" 선택
   - 싫어하는 음식: "당근", "오이" 선택
   - 매운맛 레벨: "보통" 선택
   - 요리 실력: "초급" 선택
3. 저장 버튼 클릭

**예상 결과**:
- ✅ 선호도가 저장됨
- ✅ 페이지 새로고침 후에도 선호도가 유지됨
- ✅ Prisma Studio에서 `user_preferences` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트 (선택사항)
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/users/me
```

---

### 테스트 3: 냉장고 관리

**목적**: 냉장고 재료 추가/삭제가 API로 저장되는지 확인

**절차**:
1. 하단 네비게이션에서 "냉장고" 클릭
2. 재료 추가:
   - "양파" 추가
   - "마늘" 추가
   - "계란" 추가
3. 재료 삭제:
   - "양파" 클릭하여 삭제

**예상 결과**:
- ✅ 재료 추가 시 즉시 UI에 반영
- ✅ 재료 삭제 시 즉시 UI에서 제거
- ✅ 페이지 새로고침 후에도 데이터 유지
- ✅ Prisma Studio에서 `fridge_items` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/fridge
```

---

### 테스트 4: 레시피 선호도 (스와이프)

**목적**: 레시피 좋아요/싫어요가 API로 저장되는지 확인

**절차**:
1. 하단 네비게이션에서 "식단표" 클릭
2. "식단 만들기" 버튼 클릭
3. 스와이프 페이지에서:
   - 몇 개의 레시피를 오른쪽으로 스와이프 (좋아요)
   - 몇 개의 레시피를 왼쪽으로 스와이프 (싫어요)
4. "완료" 버튼 클릭

**예상 결과**:
- ✅ 좋아요한 레시피가 식단 생성에 반영됨
- ✅ 싫어요한 레시피는 식단에서 제외됨
- ✅ Prisma Studio에서 `liked_recipes`, `disliked_recipes` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/recipes/liked

curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/recipes/disliked
```

---

### 테스트 5: 식단표 생성 및 관리

**목적**: 식단표 생성 및 수정이 API로 저장되는지 확인

**절차**:
1. 냉장고 페이지에서 "이 재료로 식단 추천받기" 버튼 클릭
2. 식단이 자동 생성되는지 확인
3. 식단표 페이지에서:
   - 특정 식단 슬롯 클릭
   - "메뉴 교체" 버튼 클릭
   - 다른 레시피 선택

**예상 결과**:
- ✅ 식단이 14개 슬롯으로 생성됨
- ✅ 메뉴 교체 시 즉시 반영됨
- ✅ 페이지 새로고침 후에도 식단 유지
- ✅ Prisma Studio에서 `plans` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/plans
```

---

### 테스트 6: 장보기 목록

**목적**: 장보기 체크리스트가 API로 저장되는지 확인

**절차**:
1. 하단 네비게이션에서 "장보기" 클릭
2. 몇 개의 항목을 체크/언체크
3. 페이지를 새로고침

**예상 결과**:
- ✅ 체크 상태가 즉시 반영됨
- ✅ 페이지 새로고침 후에도 체크 상태 유지
- ✅ Prisma Studio에서 `shopping_checks` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/shopping-list
```

---

### 테스트 7: 식사 완료 상태

**목적**: 식사 완료 체크가 API로 저장되는지 확인

**절차**:
1. 홈 페이지에서 오늘의 점심/저녁 체크박스 클릭
2. 다른 페이지로 이동 후 다시 홈으로 돌아옴
3. 체크 상태가 유지되는지 확인

**예상 결과**:
- ✅ 체크 상태가 즉시 반영됨
- ✅ 페이지 이동 후에도 체크 상태 유지
- ✅ Prisma Studio에서 `meal_finished` 테이블에 데이터 확인

**검증**:
```bash
# API 직접 호출 테스트
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/meals/finished/2024-12-09/lunch

curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:3001/api/meals/finished/2024-12-09/dinner
```

---

### 테스트 8: 에러 처리

**목적**: 네트워크 오류 및 인증 오류 처리 확인

**절차**:
1. 백엔드 서버 중지
2. 프론트엔드에서 냉장고 재료 추가 시도
3. 백엔드 서버 재시작
4. 다시 재료 추가 시도

**예상 결과**:
- ✅ 백엔드 중지 시 적절한 에러 메시지 표시
- ✅ 백엔드 재시작 후 정상 동작
- ✅ 데이터 손실 없음

---

### 테스트 9: 로그아웃 및 재로그인

**목적**: 로그아웃 후 재로그인 시 데이터 유지 확인

**절차**:
1. 프로필 페이지에서 로그아웃
2. 다시 카카오 로그인
3. 이전 데이터가 유지되는지 확인

**예상 결과**:
- ✅ 로그아웃 시 모든 상태 초기화
- ✅ 재로그인 시 이전 데이터 복원
- ✅ 사용자별 데이터 분리 확인

---

### 테스트 10: 계정 삭제

**목적**: 계정 삭제 시 모든 데이터 삭제 확인

**절차**:
1. 프로필 페이지에서 "계정 삭제" 클릭
2. 확인 다이얼로그에서 확인
3. Prisma Studio에서 관련 데이터 삭제 확인

**예상 결과**:
- ✅ 계정 삭제 시 로그아웃됨
- ✅ Prisma Studio에서 사용자 관련 모든 데이터 삭제 확인
- ✅ Cascade delete가 정상 작동

**주의**: 이 테스트는 마지막에 수행하세요. 테스트 후 다시 로그인해야 합니다.

---

## 테스트 체크리스트

### 기본 기능
- [ ] 카카오 로그인
- [ ] 사용자 정보 조회
- [ ] 선호도 설정 및 조회
- [ ] 냉장고 재료 추가/삭제
- [ ] 레시피 좋아요/싫어요
- [ ] 식단표 생성
- [ ] 식단표 수정
- [ ] 장보기 목록 체크
- [ ] 식사 완료 체크

### 데이터 일관성
- [ ] 페이지 새로고침 후 데이터 유지
- [ ] 페이지 이동 후 데이터 유지
- [ ] 로그아웃 후 재로그인 시 데이터 복원
- [ ] 여러 사용자 간 데이터 분리

### 에러 처리
- [ ] 네트워크 오류 처리
- [ ] 인증 오류 처리
- [ ] 잘못된 요청 처리

### 성능
- [ ] API 응답 시간 확인
- [ ] 페이지 로딩 시간 확인
- [ ] 데이터 동기화 속도 확인

---

## 문제 해결

### 백엔드 서버가 시작되지 않음

**원인**: 포트 3001이 이미 사용 중이거나 데이터베이스 연결 오류

**해결책**:
```bash
# 포트 확인
lsof -i :3001

# 데이터베이스 연결 확인
cd backend
psql -U kimsein -d eatconomy -c "SELECT 1;"
```

### 프론트엔드에서 API 호출 실패

**원인**: CORS 오류 또는 API URL 설정 오류

**해결책**:
1. `.env` 파일에서 `VITE_API_BASE_URL` 확인
2. 백엔드 `main.ts`에서 CORS 설정 확인
3. 브라우저 콘솔에서 네트워크 오류 확인

### 데이터가 저장되지 않음

**원인**: JWT 토큰이 없거나 만료됨

**해결책**:
1. 브라우저 개발자 도구에서 `localStorage.getItem('eat_jwt_token')` 확인
2. 로그아웃 후 다시 로그인
3. 백엔드 로그에서 인증 오류 확인

---

## 테스트 결과 기록

테스트 완료 후 다음 정보를 기록하세요:

- 테스트 날짜: ___________
- 테스트 환경: macOS / Windows / Linux
- 백엔드 버전: ___________
- 프론트엔드 버전: ___________
- 발견된 문제: ___________
- 해결 방법: ___________

---

## 다음 단계

모든 테스트가 통과하면 **Phase 5: 배포**로 진행할 수 있습니다.

